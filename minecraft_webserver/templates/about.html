<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Serverstatistiken</title>

    <link href="./static/css/header.css" rel="stylesheet" />
    <link href="./static/css/index.css" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="./static/images/favicon.ico"
      rel="icon"
      type="image/vnd.microsoft.icon"
    />
    <style>
      .chart-container {
        width: 400px; /* Breite des Container-Divs */
        height: 200px; /* Höhe des Container-Divs */
      }
      body {
        font-family: "Arial", sans-serif;
        background-color: #d0d0d0 !important;
        color: #333;
        text-align: center;
        padding-top: 20px;
      }
      header {
        text-align: left;
      }

      h1 {
        color: #004080;
      }

      .stat-container {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        margin-top: 20px;
      }

      .stat-box {
        background-color: #fff;
        border: 1px solid #ddd;
        padding: 20px;
        margin: 10px;
        border-radius: 8px;
        flex: 1;
        max-width: 400px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease-in-out;
      }

      .stat-box:hover {
        transform: scale(1.05);
      }

      .code-details {
        margin-top: 10px;
        font-size: 0.8em;
        color: #666;
      }

      #plugins-box {
        flex: 2; /* Breiterer Bereich für Plugins */
      }

      .plugins-list {
        list-style-type: none;
        padding: 0;
        text-align: left;
      }

      .plugin-item {
        background-color: #e6f7ff; /* Hellblaue Hintergrundfarbe als Akzent */
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .plugin-item a {
        color: #004080;
        text-decoration: none;
      }

      .plugin-item a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    {% include 'header.html' %}
    <h1>Serverstatistiken</h1>
    <br />

    <div class="stat-container">
      <div class="stat-box">
        <h2>Serverauslastung:</h2>
        <hr />
        <h3>CPU</h3>
        <p id="cpu_stats">Auslastung: X%</p>
        <div class="chart-container" id="cpu">
          <canvas id="usageChart_cpu"></canvas>
        </div>
        <h3>RAM</h3>
        <p id="ram_stats">In Benutzung: XGB/12GB</p>
        <div class="chart-container" id="ram">
            <canvas id="usageChart_ram"></canvas>
          </div>
      </div>
      <div class="stat-box" id="plugins-box">
        <h2>Plugins</h2>
        <hr>
        <ul class="plugins-list">
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/easyNewCraftingRecipes"
              >easyNewCraftingRecipes-1.1</a
            >
            <span class="code-details">Zeilen Code: 76</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/betterJoinMessages"
              >BetterJoinMessages - 1.1
            </a>
            <span class="code-details">Zeilen Code: 94</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/SpawnElytra"
              >SpawnElytra-1.1</a
            >
            <span class="code-details">Zeilen Code: 117</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/EasyHeadDrop"
              >EasyHeadDrop-1.1</a
            >
            <span class="code-details">Zeilen Code: 108</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/EasyShowMessage"
              >EasyShowMessage-1.1</a
            >
            <span class="code-details">Zeilen Code: 178</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/SpawnProtection"
              >spawnProtect-1.1</a
            >
            <span class="code-details">Zeilen Code: 234</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/ServerConnector"
              >ServerConnector-1.1</a
            >
            <span class="code-details">Zeilen Code: 435</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/PermissionSystem"
              >PermissionSystem-1.1</a
            >
            <span class="code-details">Zeilen Code: 454</span>
          </li>
          <li class="plugin-item">
            <a
              target="_blank"
              href="https://github.com/Tobias-Auer/Java/tree/main/Minecraft%20plugins/EasyBan"
              >EasyBan - 1.1</a
            >
            <span class="code-details">Zeilen Code: 549</span>
          </li>
        </ul>
      </div>
      <!-- Framework -->
      <div class="stat-box">
        <h2>Tech Stack</h2>
        <hr />
        <h3>Website:</h3>
        <p><strong>Frontend:</strong> Vanilla Js, HTML5, CSS</p>
        <p><strong>Backend:</strong> Python 3.12, Flask, SQLite3</p>
        <br>
        <h3>Minecraft Server:</h3>
        <p><strong>Serversoftware: </strong>PaperMC 1.20.1 (Docker)</p>
        <p><strong>Plugins: </strong>Java (Spigot)</p>
      </div>
      <!-- </div>
    <div class="stat-container"> -->
    </div>
    <script>
      const eventSource = new EventSource("/api/hardware");

      eventSource.onmessage = function (event) {
        const data = event.data;
        console.log(data);
        document.getElementById(
          "cpu_stats"
        ).innerText = `Auslastung: ${Math.round(
          event.data.split(":")[0] / 8
        )}%`;
        document.getElementById("ram_stats").innerText = `In Benutzung:  ${
          event.data.split(":")[1]
        }GB/12GB`;
        addData(event.data.split(":")[0]/8,event.data.split(":")[1])
      };

      eventSource.onerror = function (event) {
        console.error("EventSource failed:", event);
      };
    </script>
    <script>
      var data_cpu = {
        labels: [],
        datasets: [
          {
            label: "CPU",
            borderColor: "rgba(255, 99, 132, 1)",
            borderWidth: 1,
            fill: false,
            data: [],
          },
        ],
      };

      var options = {
        scales: {
          yAxes: [
            {
              ticks: {
                beginAtZero: true,
              },
            },
          ],
        },
      };
      var data_ram = {
        labels: [],
        datasets: [
          {
            label: "RAM",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1,
            fill: false,
            data: [],
          },
        ],
      };



      // Erstellen des Diagramms
      var ctx_cpu = document.getElementById("usageChart_cpu").getContext("2d");
      var usageChart_cpu = new Chart(ctx_cpu, {
        type: "line",
        data: data_cpu,
        options: options,
      });
      var ctx_ram = document.getElementById("usageChart_ram").getContext("2d");
      var usageChart_ram = new Chart(ctx_ram, {
        type: "line",
        data: data_ram,
        options: options,
      });
      
      function addData(cpuUsage, ramUsage) {

        
        var timestamp = new Date().toLocaleTimeString();
        usageChart_cpu.data.labels.push(timestamp);
        usageChart_ram.data.labels.push(timestamp);
        
        usageChart_cpu.data.datasets[0].data.push(cpuUsage);
        usageChart_ram.data.datasets[0].data.push(ramUsage);
        usageChart_cpu.update();
        usageChart_ram.update();
  
        if (usageChart_cpu.data.labels.length > maxDataPoints) {
          usageChart_cpu.data.labels.shift();
          usageChart_cpu.data.datasets[0].data.shift();
        }

        if (usageChart_ram.data.labels.length > maxDataPoints) {
          usageChart_ram.data.labels.shift();
          usageChart_ram.data.datasets[0].data.shift();
        }

        usageChart_cpu.update();
        usageChart_ram.update();
      }

      var maxDataPoints = 50;
    </script>
  </body>
</html>
